---
# yamllint disable rule:line-length
- name: 'Live API test | prepare'
  hosts: 'all'
  gather_facts: false
  tasks:
    - name: 'Live API test | prepare | API TESTING NOT ENABLED'
      when: not github_testing_enable
      ansible.builtin.fail:
        msg: |
          TEST WILL NOT EXECUTE UNLESS IT IS EXPLICITLY ENABLED.

          Set github_testing_enable: true to test live API commands.

            molecule test -s live_api_test -- -v -e 'github_testing_enable=true'

          Additionally, a github token may be provided to test authenticated API use:

            molecule test -s live_api_test -- -v -e 'github_testing_enable=true,github_personal_access_token={TOKEN}'

    - name: 'Live API test | prepare | install packages for verify'
      ansible.builtin.apt:
        name:
          - 'ca-certificates'  # SSL support for ansible.builtin.get_url.
          - 'rsync'  # ansible.posix.synchronize.
        update_cache: true
        state: 'present'
